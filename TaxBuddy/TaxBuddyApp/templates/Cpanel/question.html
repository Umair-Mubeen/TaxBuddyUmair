<!DOCTYPE html>
<html>
{% load static %}

{% include 'Cpanel/reusable.html' %}
<head>
    <title>Add Quiz Question – TaxBuddy Umair</title>

<style>
.quiz-card{
    border:none;border-radius:14px;
    box-shadow:0 15px 40px rgba(13,44,84,.1)
}
.quiz-card-header{
    background:linear-gradient(135deg,#0d2c54,#093a75);
    color:#fff;border-radius:14px 14px 0 0;
    padding:18px 22px
}
.quiz-card-header h5{font-weight:700}

.option-card{
    display:flex;justify-content:space-between;
    gap:12px;background:#f8fafc;
    border:1px solid #e5e7eb;
    border-radius:10px;
    padding:12px;margin-bottom:12px
}
.option-label{
    width:36px;height:36px;background:#0d2c54;
    color:#fff;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    font-weight:700
}
.btn-primary{background:#0d2c54;border:none}
.btn-primary:hover{background:#093a75}
</style>
</head>

<body class="sidebar-mini layout-fixed sidebar-collapse">

<div class="wrapper">
{% include 'Cpanel/navbar.html' %}
{% include 'Cpanel/sidebar.html' %}

<div class="content-wrapper">

<div class="content-header">
<div class="container-fluid">
<h1 class="m-0">Add MCQ Question</h1>
</div>
</div>

<div class="container-fluid mt-4">
<div class="row justify-content-center">
<div class="col-lg-10">

<div class="card quiz-card">
<div class="card-header quiz-card-header">
<h5>Add New Tax MCQ</h5>
</div>

<div class="card-body">
<form method="POST" action="{% if id %}{% url url id %}{% else %}{% url url %}{% endif %}">
{% csrf_token %}

<!-- Question -->
<div class="mb-3">
<label class="fw-semibold">Question *</label>
<input type="text" name="question_text" class="form-control"
       value="{{ question.question_text }}"
       required>
</div>

<!-- Category -->
<div class="mb-3">
<label class="fw-semibold">Category *</label>
<input type="text" name="category" class="form-control"
       value="{{ question.category }}"
       required>
</div>

<!-- Difficulty -->
<div class="mb-3">
<label class="fw-semibold">Difficulty</label>
<select name="difficulty" class="form-select form-control">
    <option value="basic" {% if question.difficulty == "basic" %}selected{% endif %}>
        Basic
    </option>
    <option value="intermediate" {% if question.difficulty == "intermediate" %}selected{% endif %}>
        Intermediate
    </option>
    <option value="advanced" {% if question.difficulty == "advanced" %}selected{% endif %}>
        Advanced
    </option>
</select>
</div>

<!-- Section Reference -->
<div class="mb-3">
<label class="fw-semibold">Section Reference</label>
<input type="text" name="section_ref" class="form-control"
       value="{{ question.section_ref }}">
</div>

<!-- Explanation -->
<div class="mb-3">
<label class="fw-semibold">Explanation *</label>
<textarea name="explanation" rows="3" class="form-control" required>
{{ question.explanation }}</textarea>
</div>

<hr>

<label class="fw-semibold mb-2">
Options <small class="text-muted">(Select ONLY one correct)</small>
</label>

<input type="hidden" name="correct_option" id="correct_option"
       value="{% if id %}
              {% for opt in options %}
              {% if opt.is_correct %}{{ forloop.counter0 }}{% endif %}
              {% endfor %}
              {% endif %}">

{% if id %}
    {# -------- EDIT MODE -------- #}
    {% for opt in options %}
    <div class="option-card">
        <div class="d-flex gap-2 flex-grow-1">
          <span class="option-label">
    {{ "ABCD"|slice:forloop.counter0|add:1 }}
</span>
            <input type="text"
                   name="options[]"
                   class="form-control"
                   value="{{ opt.option_text }}"
                   required>
        </div>

        <div class="form-check">
            <input class="form-check-input correct-check"
                   type="radio"
                   name="correct_radio"
                   {% if opt.is_correct %}checked{% endif %}>
        </div>
    </div>
    {% endfor %}

{% else %}
    {# -------- ADD MODE -------- #}
    {% for i in "1234" %}
    <div class="option-card">
        <div class="d-flex gap-2 flex-grow-1">
            <span class="option-label">
    {{ "ABCD"|slice:forloop.counter0|add:1 }}
</span>
            <input type="text"
                   name="options[]"
                   class="form-control"
                   placeholder="Option {{ forloop.counter }}"
                   required>
        </div>

        <div class="form-check">
            <input class="form-check-input correct-check"
                   type="radio"
                   name="correct_radio">
        </div>
    </div>
    {% endfor %}
{% endif %}

<!-- Active -->
<div class="form-check mt-3">
<input class="form-check-input" type="checkbox" name="is_active"
       {% if question.is_active %}checked{% endif %}>
<label class="form-check-label">Active Question</label>
</div>

<div class="d-grid mt-4">
<button type="submit" class="btn btn-primary btn-lg">
Update Question
</button>
</div>

</form>
</div>

<div class="card-footer text-center small text-muted">
© TaxBuddy Umair
</div>

</div>
</div>
</div>
</div>

</div>
</div>

{% include 'Cpanel/footer.html' %}

<script>
document.querySelectorAll(".correct-check").forEach((radio, index) => {
    radio.addEventListener("change", function () {
        document.getElementById("correct_option").value = index;
    });
});
</script>

</body>
</html>
